{% extends "layouts/page.njk" %}

{% block content %}
  <h1 class="govuk-heading-l">Services</h1>

  {% if services and services | length %}
    <div class="govuk-accordion" data-module="govuk-accordion" id="services-accordion">
    {% for service in services %}
      <div class="govuk-accordion__section govuk-accordion__section--expanded">
        <div class="govuk-accordion__section-header">
          <h2 class="govuk-accordion__section-heading">
            <span class="govuk-accordion__section-button" id="service-{{ loop.index }}">{{ service.label }}</span>
          </h2>
          {% if service.heading %}
            <div class="govuk-accordion__section-summary govuk-body">{{ service.heading }}</div>
          {% endif %}
        </div>
        <div id="service-content-{{ loop.index }}" class="govuk-accordion__section-content"
             aria-labelledby="service-{{ loop.index }}">
          <div class="govuk-grid-row tile-grid">
          {% set serviceRoles = roles | filterByKeyValue("services", service.key) %}
          {% for serviceRole in serviceRoles | sort("label") %}
            {% set enrolledService = registeredRoles | filterByKeyValue("key", serviceRole.key) %}
            <div class="govuk-grid-column-one-third">
              <div class="govuk-summary-card govuk-!-margin-bottom-6">
                <div class="govuk-summary-card__title-wrapper">
                  <h4 class="govuk-summary-card__title">{{ serviceRole.label }}</h4>
                </div>
                <div class="govuk-summary-card__content">
                  <p class="govuk-body">Access the service as a {{ serviceRole.label | lower }}.</p>
                  <div class="govuk-button-group">
                    {% if enrolledService and enrolledService | length %}
                    <a class="govuk-button" href="/login/{{ service.key }}/{{ serviceRole.key }}">Continue to login</a>
                    <a class="govuk-button govuk-button--secondary" href="/config/{{ service.key }}/{{ serviceRole.key }}">View configuration</a>
                    {% else %}
                    <a class="govuk-button" href="/register/{{ service.key }}/{{ serviceRole.key }}">Enrol in service</a>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
    </div>
  {% else %}
    <p class="govuk-body">No services available.</p>
  {% endif %}
{% endblock %}
